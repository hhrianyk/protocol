# Trust Wallet Token Import

Смарт-контракт и веб-интерфейс для безопасного импорта токенов в Trust Wallet с использованием криптографических подписей.

## Основные возможности

- Импорт токенов TRC20 и ERC20 с криптографической подписью
- Поддержка пакетного импорта нескольких токенов
- Механизм мультиподписи (multi-signature) для критических операций
- Система временной блокировки (timelock) для важных изменений
- Автоматическое продление срока действия импорта
- Интеграция с популярными DEX для обмена токенов
- Интеграция с оракулами Chainlink для получения актуальных цен на токены
- Система контроля доступа на основе ролей (RBAC)
- Настройка индивидуальных таймаутов для разных категорий токенов
- Администраторская панель для управления и мониторинга
- Пользовательское определение метаданных токенов (имя, символ, decimals)
- Подписанные разрешения на внесение изменений в структуру кошелька
- Система отслеживания изменений с криптографическим доказательством согласия

## Структура проекта

```
/
├── contracts/                  # Смарт-контракты
│   └── TrustWalletTokenImport.sol  # Основной контракт
├── public/                     # Пользовательский интерфейс
│   ├── index.html              # Основная HTML страница
│   ├── styles.css              # CSS-стили
│   └── app.js                  # JavaScript для клиентской части
├── admin/                      # Панель администратора
│   ├── index.html              # HTML для админ-панели
│   ├── styles.css              # CSS для админ-панели
│   └── app.js                  # JavaScript для админ-панели
├── server.js                   # Серверная часть (Express.js)
├── tests/                      # Тесты
│   ├── contract.test.js        # Тесты для смарт-контракта
│   └── api.test.js             # Тесты для API
├── package.json                # Зависимости проекта
└── .env                        # Файл конфигурации
```

## Технологический стек

- **Смарт-контракты**: Solidity, OpenZeppelin
- **Фронтенд**: HTML, CSS, JavaScript (чистый JS)
- **Бэкенд**: Node.js, Express.js
- **Авторизация**: JWT
- **Соединение с блокчейном**: Web3.js, Ethers.js
- **Реал-тайм соединение**: Socket.io
- **Тесты**: Mocha, Chai, Jest

## Установка и запуск

### Предварительные требования

- Node.js >= 14.0.0
- NPM >= 6.0.0
- Ganache для локальной разработки (опционально)

### Установка

```bash
# Клонирование репозитория
git clone https://github.com/your-username/trust-wallet-token-import.git
cd trust-wallet-token-import

# Установка зависимостей
npm install
```

### Настройка

Создайте файл `.env` на основе `.env.example` и заполните необходимые параметры:

```
PORT=4000
ADMIN_PORT=4001
JWT_SECRET=your_secret_jwt_key
ADMIN_USERNAME=admin
ADMIN_PASSWORD=secure_password
WEB3_PROVIDER=http://localhost:8545
CONTRACT_ADDRESS=0x...
BASE_URL=http://localhost:4000
ADMIN_ADDRESS=0x...
ADMIN_PRIVATE_KEY=your_private_key
```

### Запуск

```bash
# Запуск сервера в режиме разработки
npm run dev

# Запуск сервера в продакшн-режиме
npm start

# Запуск тестов
npm test
```

## Использование

### Для пользователей

1. Администратор генерирует ссылку для импорта токена
2. Пользователь открывает ссылку в браузере
3. Пользователь подключает кошелек Trust Wallet
4. Пользователь подписывает сообщение для подтверждения импорта
5. Токен автоматически добавляется в кошелек пользователя

### Импорт токена с пользовательскими метаданными

1. Пользователь выбирает опцию "Импорт с пользовательскими метаданными"
2. Пользователь вводит адрес токена и указывает желаемые метаданные (имя, символ, decimals)
3. Пользователь подписывает сообщение для подтверждения изменений
4. Токен импортируется с указанными пользователем метаданными

### Обновление метаданных существующего токена

1. Пользователь выбирает токен для обновления метаданных
2. Пользователь вводит новые значения метаданных
3. Пользователь подписывает сообщение для подтверждения изменений
4. Метаданные токена обновляются в соответствии с указанными значениями

### Для администраторов

1. Откройте панель администратора по адресу http://localhost:4001
2. Войдите с учетными данными из файла .env
3. Используйте интерфейс для создания ссылок и мониторинга активности
4. Просматривайте историю изменений метаданных и подписанных разрешений

## API Endpoints

### Пользовательские эндпоинты

- `POST /api/import-token-with-metadata` - Импорт токена с пользовательскими метаданными
- `POST /api/update-token-metadata` - Обновление метаданных существующего токена
- `POST /api/sign-wallet-modification` - Подпись разрешения на изменение кошелька
- `POST /api/get-metadata-message-hash` - Получение хеша сообщения для подписи метаданных

### WebSocket События

- `signMetadataChange` - Подписание изменений метаданных
- `metadataChangeAccepted` - Подтверждение изменения метаданных
- `metadataUpdated` - Уведомление об обновлении метаданных

## Структура подписанных сообщений

### Импорт токена
```
msg.sender + tokenId + timestamp
```

### Импорт с метаданными
```
msg.sender + tokenId + "metadata_change" + name + symbol + decimals + timestamp
```

### Обновление метаданных
```
msg.sender + tokenId + "update_metadata" + name + symbol + decimals + timestamp
```

## Безопасность

- Все операции импорта токенов требуют криптографической подписи
- Критические изменения в контракте требуют мультиподписи
- Администраторские действия защищены JWT и RBAC
- Все чувствительные операции логируются
- Каждое изменение в структуре кошелька требует явной подписи пользователя
- Все подписи проверяются на соответствие отправителю запроса

## Тестирование

```bash
# Запуск всех тестов
npm test

# Запуск тестов контракта
npm run test:contract

# Запуск тестов API
npm run test:api
```

## Лицензия

MIT 